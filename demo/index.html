<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      html {
        font-family: 'Roboto', sans-serif;
      }
      body {
        background: #fafafa;
      }
      html,
      body,
      hod-upload-file {
        height: 100%;
        width: 100%;
        margin: 0;
        display: flex;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css?family=Material+Icons&display=block"
      rel="stylesheet"
    />
    <link
      href="http://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body>
    <file-storage-demo></file-storage-demo>

    <script type="module">
      import {
        UploadFiles,
        FileStorageService,
        fileStorageServiceContext,
      } from '../dist';
      import { css, html, LitElement } from 'lit';
      import { ScopedElementsMixin } from '@open-wc/scoped-elements';
      import { ContextProvider } from '@lit-labs/context';
      import { AppWebsocket } from '@holochain/conductor-api';
      import { HolochainClient } from '@holochain-open-dev/cell-client';

      customElements.define(
        'file-storage-demo',
        class extends ScopedElementsMixin(LitElement) {
          async firstUpdated() {
            const appWebsocket = await AppWebsocket.connect(
              `ws://localhost:${process.env.HC_PORT}`
            );
            const appInfo = await appWebsocket.appInfo({
              installed_app_id: 'test-app',
            });

            const cellData = appInfo.cell_data.find(cellData =>
              cellData.cell_nick.includes('provider')
            );

            const service = new FileStorageService(
              new HolochainClient(appWebsocket, cellData),
              'file_storage_provider'
            );

            new ContextProvider(this, fileStorageServiceContext, service);
            this.loaded = true;
            this.requestUpdate();
          }

          render() {
            if (!this.loaded) return html`Loading...`;
            return html`<upload-files></upload-files>`;
          }

          static get scopedElements() {
            return {
              'upload-files': UploadFiles,
            };
          }
        }
      );
    </script>
  </body>
</html>
