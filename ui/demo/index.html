<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      html {
        font-family: "Roboto", sans-serif;
      }
      body {
        background: #fafafa;
      }
      html,
      body,
      hod-upload-file {
        height: 100%;
        width: 100%;
        margin: 0;
        display: flex;
      }
    </style>
  </head>
  <body>
    <file-storage-demo></file-storage-demo>

    <script type="module">
      import "@shoelace-style/shoelace/dist/themes/light.css";
      import { FileStorageClient, fileStorageClientContext } from "../src";
      import "../src/elements/upload-files.ts";
      import "../src/elements/show-image.ts";
      import { css, html, LitElement } from "lit";
      import { ContextProvider } from "@lit-labs/context";
      import { AppAgentWebsocket } from "@holochain/client";
      import { onSubmit } from "@holochain-open-dev/elements";

      customElements.define(
        "file-storage-demo",
        class extends LitElement {
          static properties = {
            hash: { type: Object },
            loaded: { type: Boolean },
          };

          async firstUpdated() {
            const hcclient = await AppAgentWebsocket.connect("", "");

            const client = new FileStorageClient(
              hcclient,
              "file_storage_provider"
            );

            new ContextProvider(this, fileStorageClientContext, client);
            this.loaded = true;
            this.requestUpdate();
          }

          render() {
            if (!this.loaded) return html`Loading...`;
            return html`
              <form ${onSubmit((data) => console.log(data))}>
                <upload-files
                  id="uf"
                  .oneFile=${true}
                  required
                  name="file_hash"
                  @file-uploaded=${(e) => {
                    this.hash = e.detail.file.hash;
                  }}
                ></upload-files>
                ${
                  this.hash
                    ? html`<show-image .imageHash=${this.hash}></show-image>

                        <upload-files
                          .defaultValue=${this.hash}
                          .oneFile=${true}
                          name="file_hash"
                        ></upload-files> `
                    : html``
                }
                <input type="submit"></input>
              </form>
            `;
          }

          static get scopedElements() {
            return {
              "upload-files": UploadFiles,
              "show-image": ShowImage,
            };
          }
        }
      );
    </script>
  </body>
</html>
