<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      html {
        font-family: 'Roboto', sans-serif;
      }
      body {
        background: #fafafa;
      }
      html,
      body,
      hod-upload-file {
        height: 100%;
        width: 100%;
        margin: 0;
        display: flex;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css?family=Material+Icons&display=block"
      rel="stylesheet"
    />
    <link
      href="http://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body>
    <file-storage-demo></file-storage-demo>

    <script type="module">
      import {
        UploadFiles,
        FileStorageClient,
        fileStorageClientContext,
        ShowImage
      } from '../dist';
      import { css, html, LitElement } from 'lit';
      import { ScopedElementsMixin } from '@open-wc/scoped-elements';
      import { ContextProvider } from '@lit-labs/context';
      import { HolochainClient, CellClient } from '@holochain-open-dev/common';
      import { AppWebsocket } from '@holochain/client';

      customElements.define(
        'file-storage-demo',
        class extends ScopedElementsMixin(LitElement) {
          static properties= {
            
              hash: {type: Object},
              loaded: {type: Boolean}
            
          }
          
          async firstUpdated() {
            const appWs = await AppWebsocket.connect(
              `ws://localhost:${process.env.HC_PORT}`,
            );
            const appInfo = await appWs.appInfo({
              installed_app_id: 'test-app'
            });
            
            const hcclient = new HolochainClient(appWs);
            
            const cellClient = new CellClient(hcclient, appInfo.cell_data.find(c => c.role_id === 'file_storage_provider'));

            const client = new FileStorageClient(
              cellClient             
            );

            new ContextProvider(this, fileStorageClientContext, client);
            this.loaded = true;
            this.requestUpdate();
          }

          render() {
            if (!this.loaded) return html`Loading...`;
            return html`<upload-files @file-uploaded=${e => this.hash = e.detail.hash}></upload-files>
            ${this.hash? html`<show-image .imageHash=${this.hash}></show-image>`: html``}
            `;
          }

          static get scopedElements() {
            return {
              'upload-files': UploadFiles,
              'show-image': ShowImage,
            };
          }
        }
      );
    </script>
  </body>
</html>
