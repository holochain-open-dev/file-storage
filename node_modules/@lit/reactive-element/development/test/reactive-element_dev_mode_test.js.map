{"version":3,"file":"reactive-element_dev_mode_test.js","sourceRoot":"","sources":["../../src/test/reactive-element_dev_mode_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {ReactiveElement} from '../reactive-element.js';\nimport {generateElementName} from './test-helpers.js';\nimport {assert} from '@esm-bundle/chai';\n\n// Note, since tests are not built with production support, detect DEV_MODE\n// by checking if warning API is available.\nconst DEV_MODE = !!ReactiveElement.enableWarning;\n\nif (DEV_MODE) {\n  suite('Developer mode warnings', () => {\n    let container: HTMLElement;\n    let warnings: string[] = [];\n\n    const missingPlatformSupport =\n      window.ShadyDOM?.inUse &&\n      !(globalThis as any)['reactiveElementPlatformSupport'];\n\n    const consoleWarn = console.warn;\n\n    suiteSetup(() => {\n      console.warn = (message: string) => warnings.push(message);\n    });\n\n    suiteTeardown(() => {\n      console.warn = consoleWarn;\n    });\n\n    setup(() => {\n      warnings = [];\n      container = document.createElement('div');\n      document.body.appendChild(container);\n    });\n\n    teardown(() => {\n      if (container && container.parentNode) {\n        container.parentNode.removeChild(container);\n      }\n    });\n\n    // TODO(sorvell): To enable these, need to either configure the test\n    // environment before loading any code or tweak the code to make the\n    // console output detectable\n    // under testing.\n    suite.skip('Initial warnings', () => {\n      test('warns for dev mode', async () => {\n        assert.include(warnings[0], 'Do not use in production!');\n      });\n\n      (missingPlatformSupport ? test : test.skip)(\n        'warns for missing polyfill-support',\n        async () => {\n          assert.include(warnings[1], 'polyfill-support');\n        }\n      );\n    });\n\n    test('warns when `initialize` is implemented', () => {\n      class A extends ReactiveElement {\n        initialize() {}\n      }\n      customElements.define(generateElementName(), A);\n      new A();\n      assert.equal(warnings.length, 1);\n      assert.include(warnings[0], 'initialize');\n    });\n\n    test('warns on first instance only', () => {\n      class A extends ReactiveElement {\n        initialize() {}\n      }\n      customElements.define(generateElementName(), A);\n      new A();\n      new A();\n      new A();\n      assert.equal(warnings.length, 1);\n      assert.include(warnings[0], 'initialize');\n    });\n\n    test('warns when `requestUpdateInternal` is implemented', () => {\n      class A extends ReactiveElement {\n        requestUpdateInternal() {}\n      }\n      customElements.define(generateElementName(), A);\n      new A();\n      assert.equal(warnings.length, 1);\n      assert.include(warnings[0], 'requestUpdateInternal');\n    });\n\n    test('warns when updating properties are shadowed', async () => {\n      class A extends ReactiveElement {\n        static properties = {\n          fooProp: {},\n          barProp: {},\n        };\n\n        constructor() {\n          super();\n          // Simulates a class field.\n          Object.defineProperty(this, 'fooProp', {\n            value: 'foo',\n            writable: false,\n            enumerable: false,\n            configurable: true,\n          });\n          Object.defineProperty(this, 'barProp', {\n            value: 'bar',\n            writable: false,\n            enumerable: false,\n            configurable: true,\n          });\n        }\n      }\n      customElements.define(generateElementName(), A);\n      const a = new A();\n      container.appendChild(a);\n      await a.updateComplete;\n      assert.equal(warnings.length, 1);\n      assert.include(warnings[0], 'fooProp, barProp');\n      assert.include(warnings[0], 'class field');\n    });\n\n    test('warns when awaiting `requestUpdate`', async () => {\n      class A extends ReactiveElement {}\n      customElements.define(generateElementName(), A);\n      const a = new A();\n      container.appendChild(a);\n      await a.requestUpdate();\n      assert.equal(warnings.length, 1);\n      assert.include(warnings[0], 'requestUpdate');\n      assert.include(warnings[0], 'Promise');\n    });\n\n    suite('conditional warnings', () => {\n      test('warns when `toAttribute` returns undefined with migration warnings on', async () => {\n        class A extends ReactiveElement {\n          static properties = {\n            foo: {converter: {toAttribute: () => undefined}, reflect: true},\n          };\n\n          foo = 'hi';\n        }\n        A.enableWarning?.('migration');\n        customElements.define(generateElementName(), A);\n        const a = new A();\n        container.appendChild(a);\n        await a.updateComplete;\n        assert.equal(warnings.length, 1);\n        assert.include(warnings[0], 'undefined');\n      });\n\n      test('warns when update triggers another update if element', async () => {\n        class A extends ReactiveElement {\n          shouldUpdateAgain = false;\n          updated() {\n            if (this.shouldUpdateAgain) {\n              this.shouldUpdateAgain = false;\n              this.requestUpdate();\n            }\n          }\n        }\n        customElements.define(generateElementName(), A);\n        const a = new A();\n        container.appendChild(a);\n        await a.updateComplete;\n        assert.equal(warnings.length, 0);\n        a.shouldUpdateAgain = true;\n        a.requestUpdate();\n        await a.updateComplete;\n        assert.equal(warnings.length, 1);\n        assert.include(warnings[0], 'update');\n        assert.include(warnings[0], 'requested');\n        warnings = [];\n        a.requestUpdate();\n        await a.updateComplete;\n        assert.equal(warnings.length, 0);\n        a.shouldUpdateAgain = true;\n        A.disableWarning?.('change-in-update');\n        a.requestUpdate();\n        await a.updateComplete;\n        assert.equal(warnings.length, 0);\n      });\n\n      test('warning settings can be set on base class and per class', async () => {\n        class A extends ReactiveElement {\n          shouldUpdateAgain = false;\n          updated() {\n            if (this.shouldUpdateAgain) {\n              this.shouldUpdateAgain = false;\n              this.requestUpdate();\n            }\n          }\n        }\n        customElements.define(generateElementName(), A);\n        class B extends A {}\n        customElements.define(generateElementName(), B);\n        const a = new A();\n        container.appendChild(a);\n        const b = new B();\n        container.appendChild(b);\n        await a.updateComplete;\n        await b.updateComplete;\n        assert.equal(warnings.length, 0);\n        const triggerChangeInUpdate = async () => {\n          a.shouldUpdateAgain = true;\n          b.shouldUpdateAgain = true;\n          a.requestUpdate();\n          b.requestUpdate();\n          await a.updateComplete;\n          await b.updateComplete;\n        };\n        // Defeat warning in base class\n        A.disableWarning?.('change-in-update');\n        await triggerChangeInUpdate();\n        assert.equal(warnings.length, 0);\n        // Explicitly turn on warning in subclass\n        B.enableWarning?.('change-in-update');\n        warnings = [];\n        await triggerChangeInUpdate();\n        assert.equal(warnings.length, 1);\n        // Turn of warning in subclass and back on in base class\n        B.disableWarning?.('change-in-update');\n        A.enableWarning?.('change-in-update');\n        warnings = [];\n        await triggerChangeInUpdate();\n        assert.equal(warnings.length, 1);\n      });\n    });\n  });\n}\n"]}