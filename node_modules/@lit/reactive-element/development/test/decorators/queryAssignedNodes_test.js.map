{"version":3,"file":"queryAssignedNodes_test.js","sourceRoot":"","sources":["../../../src/test/decorators/queryAssignedNodes_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {queryAssignedNodes} from '../../decorators/query-assigned-nodes.js';\nimport {\n  canTestReactiveElement,\n  generateElementName,\n  RenderingElement,\n  html,\n} from '../test-helpers.js';\nimport {assert} from '@esm-bundle/chai';\n\nconst flush =\n  window.ShadyDOM && window.ShadyDOM.flush ? window.ShadyDOM.flush : () => {};\n\n(canTestReactiveElement ? suite : suite.skip)('@queryAssignedNodes', () => {\n  let container: HTMLElement;\n  let el: C;\n\n  class D extends RenderingElement {\n    @queryAssignedNodes() defaultAssigned!: Node[];\n\n    // The `true` on the decorator indicates that results should be flattened.\n    @queryAssignedNodes('footer', true) footerAssigned!: Node[];\n\n    @queryAssignedNodes('footer', true, '.item')\n    footerAssignedItems!: Element[];\n\n    render() {\n      return html`\n        <slot></slot>\n        <slot name=\"footer\"></slot>\n      `;\n    }\n  }\n  customElements.define('assigned-nodes-el', D);\n\n  class E extends RenderingElement {\n    @queryAssignedNodes() defaultAssigned!: Node[];\n\n    @queryAssignedNodes('header') headerAssigned!: Node[];\n\n    render() {\n      return html`\n        <slot name=\"header\"></slot>\n        <slot></slot>\n      `;\n    }\n  }\n  customElements.define('assigned-nodes-el-2', E);\n\n  const defaultSymbol = Symbol('default');\n  const headerSymbol = Symbol('header');\n  class S extends RenderingElement {\n    @queryAssignedNodes() [defaultSymbol]!: Node[];\n\n    @queryAssignedNodes('header') [headerSymbol]!: Node[];\n\n    render() {\n      return html`\n        <slot name=\"header\"></slot>\n        <slot></slot>\n      `;\n    }\n  }\n  customElements.define('assigned-nodes-el-symbol', S);\n\n  // Note, there are 2 elements here so that the `flatten` option of\n  // the decorator can be tested.\n  class C extends RenderingElement {\n    div!: HTMLDivElement;\n    div2!: HTMLDivElement;\n    div3!: HTMLDivElement;\n    assignedNodesEl!: D;\n    assignedNodesEl2!: E;\n    assignedNodesEl3!: S;\n\n    render() {\n      return html`\n        <assigned-nodes-el\n          ><div id=\"div1\">A</div>\n          <slot slot=\"footer\"></slot\n        ></assigned-nodes-el>\n        <assigned-nodes-el-2><div id=\"div2\">B</div></assigned-nodes-el-2>\n        <assigned-nodes-el-symbol\n          ><div id=\"div3\">B</div></assigned-nodes-el-symbol\n        >\n      `;\n    }\n\n    firstUpdated() {\n      this.div = this.renderRoot.querySelector('#div1') as HTMLDivElement;\n      this.div2 = this.renderRoot.querySelector('#div2') as HTMLDivElement;\n      this.div3 = this.renderRoot.querySelector('#div3') as HTMLDivElement;\n      this.assignedNodesEl = this.renderRoot.querySelector(\n        'assigned-nodes-el'\n      ) as D;\n      this.assignedNodesEl2 = this.renderRoot.querySelector(\n        'assigned-nodes-el-2'\n      ) as E;\n      this.assignedNodesEl3 = this.renderRoot.querySelector(\n        'assigned-nodes-el-symbol'\n      ) as S;\n    }\n  }\n  customElements.define(generateElementName(), C);\n\n  setup(async () => {\n    container = document.createElement('div');\n    container.id = 'test-container';\n    document.body.appendChild(container);\n    el = new C();\n    container.appendChild(el);\n    await el.updateComplete;\n    await el.assignedNodesEl.updateComplete;\n  });\n\n  teardown(() => {\n    if (container !== undefined) {\n      container.parentElement!.removeChild(container);\n      (container as any) = undefined;\n    }\n  });\n\n  test('returns assignedNodes for slot', () => {\n    // Note, `defaultAssigned` does not `flatten` so we test that the property\n    // reflects current state and state when nodes are added or removed.\n    assert.deepEqual(el.assignedNodesEl.defaultAssigned, [\n      el.div,\n      el.div.nextSibling!,\n    ]);\n    const child = document.createElement('div');\n    const text1 = document.createTextNode('');\n    el.assignedNodesEl.appendChild(text1);\n    el.assignedNodesEl.appendChild(child);\n    const text2 = document.createTextNode('');\n    el.assignedNodesEl.appendChild(text2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.defaultAssigned, [\n      el.div,\n      el.div.nextSibling!,\n      text1,\n      child,\n      text2,\n    ]);\n    el.assignedNodesEl.removeChild(child);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.defaultAssigned, [\n      el.div,\n      el.div.nextSibling!,\n      text1,\n      text2,\n    ]);\n  });\n\n  test('returns assignedNodes for unnamed slot that is not first slot', () => {\n    assert.deepEqual(el.assignedNodesEl2.defaultAssigned, [el.div2]);\n  });\n\n  test('returns assignedNodes for unnamed slot via symbol property', () => {\n    assert.deepEqual(el.assignedNodesEl3[defaultSymbol], [el.div3]);\n  });\n\n  test('returns flattened assignedNodes for slot', () => {\n    // Note, `defaultAssigned` does `flatten` so we test that the property\n    // reflects current state and state when nodes are added or removed to\n    // the light DOM of the element containing the element under test.\n    assert.deepEqual(el.assignedNodesEl.footerAssigned, []);\n    const child1 = document.createElement('div');\n    const child2 = document.createElement('div');\n    el.appendChild(child1);\n    el.appendChild(child2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssigned, [child1, child2]);\n    el.removeChild(child2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssigned, [child1]);\n  });\n\n  test('returns assignedNodes for slot filtered by selector', () => {\n    // Note, `defaultAssigned` does `flatten` so we test that the property\n    // reflects current state and state when nodes are added or removed to\n    // the light DOM of the element containing the element under test.\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, []);\n    const child1 = document.createElement('div');\n    const child2 = document.createElement('div');\n    child2.classList.add('item');\n    el.appendChild(child1);\n    el.appendChild(child2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, [child2]);\n    el.removeChild(child2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, []);\n  });\n\n  test('returns assignedNodes for slot that contains text nodes filtered by selector when Element.matches does not exist', () => {\n    const descriptor = Object.getOwnPropertyDescriptor(\n      Element.prototype,\n      'matches'\n    );\n    Object.defineProperty(Element.prototype, 'matches', {\n      value: undefined,\n      configurable: true,\n    });\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, []);\n    const child1 = document.createElement('div');\n    const child2 = document.createElement('div');\n    const text1 = document.createTextNode('');\n    const text2 = document.createTextNode('');\n    child2.classList.add('item');\n    el.appendChild(child1);\n    el.appendChild(text1);\n    el.appendChild(child2);\n    el.appendChild(text2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, [child2]);\n    el.removeChild(child2);\n    flush();\n    assert.deepEqual(el.assignedNodesEl.footerAssignedItems, []);\n    if (descriptor !== undefined) {\n      Object.defineProperty(Element.prototype, 'matches', descriptor);\n    }\n  });\n});\n"]}