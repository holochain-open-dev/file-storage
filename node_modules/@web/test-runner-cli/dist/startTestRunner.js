"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startTestRunner = void 0;
/* eslint-disable no-async-promise-executor */
const test_runner_core_1 = require("@web/test-runner-core");
const TestRunnerCli_1 = require("./cli/TestRunnerCli");
async function startTestRunner(config, groupConfigs = [], options = {}) {
    const { autoExitProcess = true } = options;
    const runner = new test_runner_core_1.TestRunner(config, groupConfigs);
    const cli = new TestRunnerCli_1.TestRunnerCli(config, runner);
    function stop() {
        runner.stop();
    }
    if (autoExitProcess) {
        ['exit', 'SIGINT'].forEach(event => {
            process.on(event, stop);
        });
    }
    if (autoExitProcess) {
        process.on('uncaughtException', error => {
            /* eslint-disable-next-line no-console */
            console.error(error);
            stop();
        });
    }
    runner.on('stopped', passed => {
        if (autoExitProcess) {
            process.exit(passed ? 0 : 1);
        }
    });
    await runner.start();
    cli.start();
    return runner;
}
exports.startTestRunner = startTestRunner;
//# sourceMappingURL=startTestRunner.js.map