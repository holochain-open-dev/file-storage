"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startDevServer = void 0;
const dev_server_core_1 = require("@web/dev-server-core");
const openBrowser_1 = require("./openBrowser");
const createLogger_1 = require("./logger/createLogger");
async function startDevServer(config, options = {}) {
    var _a;
    const { autoExitProcess = true, clearTerminalOnChange = false, logStartMessage = true } = options;
    const { logger, loggerPlugin } = createLogger_1.createLogger({
        // TODO: read debug
        debugLogging: false,
        clearTerminalOnChange,
        logStartMessage,
    });
    config.plugins = (_a = config.plugins) !== null && _a !== void 0 ? _a : [];
    config.plugins.push(loggerPlugin);
    const server = new dev_server_core_1.DevServer(config, logger);
    if (autoExitProcess) {
        process.on('uncaughtException', error => {
            /* eslint-disable-next-line no-console */
            console.error(error);
            stop();
        });
        process.on('SIGINT', async () => {
            await server.stop();
            process.exit(0);
        });
    }
    await server.start();
    if (config.open != null) {
        await openBrowser_1.openBrowser(config);
    }
    return server;
}
exports.startDevServer = startDevServer;
//# sourceMappingURL=startDevServer.js.map