{"version":3,"file":"eventOptions_test.js","sourceRoot":"","sources":["../../../src/test/decorators/eventOptions_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {ReactiveElement} from '../../reactive-element.js';\nimport {eventOptions} from '../../decorators/event-options.js';\nimport {\n  canTestReactiveElement,\n  generateElementName,\n  RenderingElement,\n  html,\n} from '../test-helpers.js';\nimport {assert} from '@esm-bundle/chai';\n\nlet hasOptions;\nconst supportsOptions = (function () {\n  if (hasOptions !== undefined) {\n    return hasOptions;\n  }\n  const fn = () => {};\n  const event = 'foo';\n  hasOptions = false;\n  const options = {\n    get capture() {\n      hasOptions = true;\n      return true;\n    },\n  };\n  document.body.addEventListener(event, fn, options);\n  document.body.removeEventListener(event, fn, options);\n  return hasOptions;\n})();\n\nlet hasPassive;\nconst supportsPassive = (function () {\n  if (hasPassive !== undefined) {\n    return hasPassive;\n  }\n  // Use an iframe since ShadyDOM will pass this test but doesn't actually\n  // enforce passive behavior.\n  const f = document.createElement('iframe');\n  document.body.appendChild(f);\n  const fn = () => {};\n  const event = 'foo';\n  hasPassive = false;\n  const options = {\n    get passive() {\n      hasPassive = true;\n      return true;\n    },\n  };\n  f.contentDocument!.addEventListener(event, fn, options);\n  f.contentDocument!.removeEventListener(\n    event,\n    fn,\n    options as AddEventListenerOptions\n  );\n  document.body.removeChild(f);\n  return hasPassive;\n})();\n\nlet hasOnce;\nconst supportsOnce = (function () {\n  if (hasOnce !== undefined) {\n    return hasOnce;\n  }\n  // Use an iframe since ShadyDOM will pass this test but doesn't actually\n  // enforce passive behavior.\n  const f = document.createElement('iframe');\n  document.body.appendChild(f);\n  const fn = () => {};\n  const event = 'foo';\n  hasOnce = false;\n  const options = {\n    get once() {\n      hasOnce = true;\n      return true;\n    },\n  };\n  f.contentDocument!.addEventListener(event, fn, options);\n  f.contentDocument!.removeEventListener(\n    event,\n    fn,\n    options as AddEventListenerOptions\n  );\n  document.body.removeChild(f);\n  return hasOnce;\n})();\n\n(canTestReactiveElement ? suite : suite.skip)('@eventOptions', () => {\n  let container: HTMLElement;\n\n  setup(() => {\n    container = document.createElement('div');\n    container.id = 'test-container';\n    document.body.appendChild(container);\n  });\n\n  teardown(() => {\n    if (container !== undefined) {\n      container.parentElement!.removeChild(container);\n      (container as any) = undefined;\n    }\n  });\n\n  test('allows capturing listeners', async function () {\n    if (!supportsOptions) {\n      this.skip();\n    }\n\n    class C extends RenderingElement {\n      eventPhase?: number;\n\n      @eventOptions({capture: true})\n      onClick(e: Event) {\n        this.eventPhase = e.eventPhase;\n      }\n\n      render() {\n        return html`<div><button></button></div>`;\n      }\n\n      firstUpdated() {\n        this.renderRoot\n          .querySelector('div')!\n          .addEventListener(\n            'click',\n            (e: Event) => this.onClick(e),\n            (this.onClick as unknown) as AddEventListenerOptions\n          );\n      }\n    }\n    customElements.define(generateElementName(), C);\n\n    const c = new C();\n    container.appendChild(c);\n    await c.updateComplete;\n    c.renderRoot.querySelector('button')!.click();\n    assert.equal(c.eventPhase, Event.CAPTURING_PHASE);\n  });\n\n  test('allows once listeners', async function () {\n    if (!supportsOnce) {\n      this.skip();\n    }\n\n    class C extends ReactiveElement {\n      clicked = 0;\n\n      constructor() {\n        super();\n        this.addEventListener(\n          'click',\n          () => this.onClick(),\n          (this.onClick as unknown) as AddEventListenerOptions\n        );\n      }\n\n      @eventOptions({once: true})\n      onClick() {\n        this.clicked++;\n      }\n    }\n    customElements.define(generateElementName(), C);\n\n    const c = new C();\n    container.appendChild(c);\n    await c.updateComplete;\n    c.click();\n    c.click();\n    assert.equal(c.clicked, 1);\n  });\n\n  test('allows passive listeners', async function () {\n    if (!supportsPassive) {\n      this.skip();\n    }\n\n    class C extends ReactiveElement {\n      defaultPrevented?: boolean;\n\n      constructor() {\n        super();\n        this.addEventListener(\n          'click',\n          (e: Event) => this.onClick(e),\n          (this.onClick as unknown) as AddEventListenerOptions\n        );\n      }\n\n      @eventOptions({passive: true})\n      onClick(e: Event) {\n        try {\n          e.preventDefault();\n        } catch (error) {\n          // no need to do anything\n        }\n        this.defaultPrevented = e.defaultPrevented;\n      }\n    }\n    customElements.define(generateElementName(), C);\n\n    const c = new C();\n    container.appendChild(c);\n    await c.updateComplete;\n    c.click();\n    assert.isFalse(c.defaultPrevented);\n  });\n});\n"]}